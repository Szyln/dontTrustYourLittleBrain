# 製作登入介面
## 需要的效果
- 需要可以註冊帳號密碼：[[POST 表單(express)]]
- 註冊的資料（帳號密碼）需要存到 [[Database 數據庫]]
	- [[製作登入介面#管理 Mongoose Models]]
- 下次用戶登入時，檢查輸入的帳密是否吻合 DB 的註冊內容
- 如果吻合，render ([[編譯 EJS 樣板 res.render()]]) 會員頁面

---
## [[Express Life Cycle 生命週期]]
- 註冊頁面：/signup
- 登入頁面：/login
- 會員頁面：/member

### 先建置
```js
// 匯入：express, ejs, body-parser, express-session, mongoose
// 從資料夾匯入 mongoose model （先做完下一標題）
const User = require('./models/user');
// app.set: ejs 設定
// middleware: public 資料夾, session, body-parser 設定
// connect to mongoDB by mongoose
// get: 首頁

// 這裡等等放入內容

// routing for all: 404
// middleware: error handler
// port listening
```
>- [[Routing for all 回應亂打的網址]]
>- [[Error Handling（Routing 後面）]]

#### 管理 Mongoose Models
>- [[用資料夾管理 Mongoose models 模組]]
>- [[Validators]]
建立 models -> user.js
```js
// import
const mongoose = require('mongoose');
// define a schema
const userSchema = new mongoose.Schema({
	username: {
		type: String,
	},
	password: {
		type: String,
	}
})

// create a model
const User = mongoose.model('User', userSchema);
// export(到 app.js 用)
module.exports = User;
```

### 註冊頁面
```js
// 註冊頁面： signup.ejs（生成 POST 表單） render
app.get('/signup', (req, res) => {
	res.render('signup')
})
// 處理 POST 請求，html form action 要設定到這個 route
app.post('/signup', (req, res, next) => {
	console.log(req.body);
	// 對應 html input 的 name 屬性
	let { username, password } = req.body;
	// create and object
	let newUser = new User({ username, password });
	// error handling 非同步寫法
	try {
		// save
		newUser.save().then(() => {
			res.send('感謝您，我們已經收到您的資訊');
		}).catch((e) => {
			res.send('對不起，請再重試一遍');
		})
	} catch(err) {
		next(err);
	}
})
```
>- [[Form]]>[[input]]
>- [[Create]]
>- [[變數簡寫語法糖]]
>- [[從物件中提取屬性到變數中 Destructing an object]]
>- [[透過 Mongoose 存入 MongoDB(Save)]]
>- [[Error Handling 非同步的寫法]]
>- [[async, await, try, catch]]

### 登入頁面
```js
app.get('/login', (req, res) => {
	res.render('login');
});

app.post('login', (req, res) => {
	let { username, password } = res.body;
	
})
```
### 會員頁面