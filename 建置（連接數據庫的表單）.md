# 建置（連接數據庫的表單）
用戶填入的表單資料：
- 顯示在網頁上
- 存入數據庫

## 資料夾
```
專案資料夾/
|- app/				
|	|- app.js
|- models/				
|	|- students.js
|	|- 不同的 mongoose model
|- public/				
|	|- CSS, SCSS 檔案
|- views/				
|	|- EJS 樣板
|- node_modules/				
|	|- 很多模組……
```

## app.js
- 管理 models 並匯出（[[自製模組(Node.js)]]）
- import: [[匯入模組]] express, app, ejs, mongoose, bodyParser([[body-parser]]), 自製的 models 模組
- [[Middleware(express)]]
	- CSS：[[Express 的 CSS 樣式環境建置 (Serving a Static File)]]
	- EJS：[[EJS with Express 的基本設定]]
	- POST 表單：[[body-parser]]
- [[利用 Mongoose 連上 MongoDB]]：exampleDB 可以自訂
- [[Request Handling(Express)]]
	- [[使用與操作 Mongoose]]：下一段
	- [[POST 表單(express)]]
- port listening



## Request handling（連接數據庫）
### 管理 models
建立一個 models 資料夾統一管理
- [[建立架構 Define a Schema]]
	- 建立規則：[[Validators]]
- [[Create a Model]]
- [[匯出模組]]


用填入資訊建立 object，並且存入資料庫
```
首頁(localhost)/
|- students/	-> 產生變數給 ejs 用			
|	|- insert/  -> accept / reject
|	|- 個別頁面
```
##### /students（已登入學生表）
```js
app.get('/student', async (req, res) => {
	let data = await Student.find();
	res.render('students.ejs', { data });
})
```
- 生成 students.ejs：[[編譯 EJS 樣板 res.render()]]
- 取得數據庫資料，將其作為 EJS 變數使用：[[EJS 使用 Mongoose 取得數據庫資料作為變數]]
#### /student/insert 表單
```js
app.get('/students/insert', (req, res) => {
	res.render('studentInsert.ejs');
})
```
- 生成 studentInsert.ejs（表單）
- 供填入[[form]]

##### 收到 POST 請求
```js
app.post('/student/insert', (req, res) => {
	let { id, name, age, merit, other } = req.body;
	let newStudent = new Student({
		id, name, age, scholarship: { merit, other },
	});
}) 
```
- [[建立架構 Define a Schema#create a model]]
- [[回應表單 (Routing for Query)]]
	- [[POST 表單(express)#使用用戶填入的資訊]]
		- [[從物件中提取屬性到變數中 Destructing an object]]
	- [[透過 Mongoose 存入 MongoDB(Save)]]

#js #npm #node #expressJs #mongoose #database #form #ejs #backEnd 